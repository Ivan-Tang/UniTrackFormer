# UniTrackFormer

**UniTrackFormer** æ˜¯ä¸€ä¸ªåŸºäº Transformer çš„ç«¯åˆ°ç«¯æ¨¡å‹ï¼Œä¸“æ³¨äºè§£å†³ TrackML Challenge ä¸­çš„ç²’å­è½¨è¿¹é‡å»ºé—®é¢˜ã€‚æœ¬é¡¹ç›®æ—¨åœ¨é€šè¿‡æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œå°†ç²’å­æ¢æµ‹å™¨ä¸­çš„æµ‹é‡æ•°æ®ï¼ˆhitsï¼‰åˆ’åˆ†ä¸ºå±äºåŒä¸€ç²’å­çš„è½¨è¿¹ï¼Œå®ç°é«˜æ•ˆã€å¯æ‰©å±•çš„è½¨è¿¹é‡å»ºã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```bash
trackML/
â”œâ”€â”€ code/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ dataset.py         # æ•°æ®é›†åŠ è½½ä¸ç‰¹å¾æå–
â”‚   â”‚   â”œâ”€â”€ models.py          # UniTrackFormer æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ losses.py          # å¤šä»»åŠ¡æŸå¤±å‡½æ•°å®ç°
â”‚   â”‚   â”œâ”€â”€ trainer.py         # æ¨¡å‹è®­ç»ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ kfold_trainer.py   # kfoldæ¨¡å‹è®­ç»ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ metric.py          # è¯„ä»·efficiency/fake_rateå‡½æ•°
â”‚   â”‚   â””â”€â”€ main.ipynb         # æ•°æ®æ¢ç´¢ä¸è®­ç»ƒ Notebook
â”‚   â””â”€â”€ test/                  # æµ‹è¯•è„šæœ¬ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ data/                      # æ•°æ®ç›®å½•ï¼ˆéœ€æ‰‹åŠ¨ä¸‹è½½ï¼‰
â”‚   â”œâ”€â”€ detectors.csv          # æ¢æµ‹å™¨å‡ ä½•ä¿¡æ¯
â”‚   â”œâ”€â”€ train_sample/          # ç¤ºä¾‹è®­ç»ƒé›†ï¼ˆå¤šä¸ªäº‹ä»¶ï¼‰
â”‚   â””â”€â”€ test_sample/           # ç¤ºä¾‹æµ‹è¯•é›†
â”œâ”€â”€ trackml-library/           # TrackML å®˜æ–¹å·¥å…·åº“ï¼ˆéœ€æ‰‹åŠ¨å…‹éš†ï¼‰
â””â”€â”€ README.md                  # å½“å‰è¯´æ˜æ–‡æ¡£
```

---

## âœ¨ é¡¹ç›®ç‰¹æ€§

- **æ•°æ®åŠ è½½ä¸ç‰¹å¾æå–**ï¼šä» hits, cells, detectors æ„å»ºè¾“å…¥ç‰¹å¾ï¼Œæ”¯æŒç©ºé—´ã€ç”µè·å’Œæ¨¡å—ä¿¡æ¯ã€‚
- **æ¨¡å‹è®¾è®¡**ï¼šTransformer ç¼–ç å™¨ + è§£ç å™¨ç»“æ„ï¼Œä½¿ç”¨ query æ¢æµ‹è½¨è¿¹ï¼Œæ”¯æŒèšç±»ä¸å›å½’ã€‚
- **å¤šä»»åŠ¡æŸå¤±**ï¼šåŒ…å«è½¨è¿¹åˆ†ç±»ã€æ©ç èšç±»ã€ç‰©ç†å‚æ•°å›å½’ä¸‰é¡¹å­ä»»åŠ¡ã€‚
- **è½»é‡é«˜æ•ˆ**ï¼šæ¨¡å‹æ”¯æŒ CUDA å’Œ Apple MPS åŠ é€Ÿï¼Œæ¨ç†æ—¶é—´çŸ­ï¼Œç»“æ„æ˜“éƒ¨ç½²ã€‚

---

## ğŸ“¦ å®‰è£…ä¸å‡†å¤‡

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/Ivan-Tang/UniTrackFormer.git
cd UniTrackFormer
```

### 2. ä¸‹è½½æ•°æ®é›†

å‰å¾€ [TrackML Challenge (Kaggle)](https://www.kaggle.com/c/trackml-particle-identification) é¡µé¢ä¸‹è½½ä»¥ä¸‹æ•°æ®ï¼š

- `train_sample/`ã€`test/` ç­‰äº‹ä»¶æ•°æ®
- `detectors.csv`ã€`particles.csv`ã€`truth.csv` ç­‰è¾…åŠ©ä¿¡æ¯

è§£å‹åˆ° `data/` ç›®å½•ï¼Œä½¿å…¶ç»“æ„å¦‚ä¸‹ï¼š

```bash
data/
â”œâ”€â”€ detectors.csv
â”œâ”€â”€ train_sample/
â”‚   â”œâ”€â”€ event000001000-hits.csv
â”‚   â”œâ”€â”€ event000001000-cells.csv
â”‚   â”œâ”€â”€ event000001000-particles.csv
â”‚   â””â”€â”€ event000001000-truth.csv
|   ...
â””â”€â”€ test/
    â”œâ”€â”€ event000001000-hits.csv
    â”œâ”€â”€ event000001000-cells.csv
    ...
```

### 3. å®‰è£…ä¾èµ–

å»ºè®®ä½¿ç”¨ Python â‰¥ 3.8ï¼Œæ ¸å¿ƒä¾èµ–å¦‚ä¸‹ï¼š

```bash
pip install numpy pandas torch scikit-learn
```

é¢å¤–ä¾èµ–ï¼ˆæ¨èï¼‰ï¼š

- [`trackml-library`](https://github.com/LAL/trackml-library)ï¼šç”¨äºè§£æå’Œå¯è§†åŒ– TrackML æ•°æ®ï¼ˆæ ¹æ®ä»“åº“ä¸­çš„æŒ‡å¼•åœ¨ç¯å¢ƒä¸­å®‰è£…trackMLï¼‰

---

## ğŸš€ æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°

### Jupyter Notebook äº¤äº’è®­ç»ƒ

```bash
æ‰“å¼€ code/src/main.ipynb æŸ¥çœ‹å¹¶è¿è¡Œå•äº‹ä»¶æ•°æ®è®­ç»ƒæµç¨‹
```

### è„šæœ¬æ–¹å¼è®­ç»ƒ

```bash
python src/trainer.py
python src/kfold_trainer.py
```

ä½ å¯ä»¥åœ¨ `model.py` `trainer.py` `kfold_trainer.py` ä¸­ä¿®æ”¹è¶…å‚æ•°ï¼ˆå¦‚ batch sizeã€å­¦ä¹ ç‡ç­‰ï¼‰ï¼Œæ”¯æŒå¤šäº‹ä»¶è¿­ä»£è®­ç»ƒä¸ä¿å­˜æ¨¡å‹ã€‚
è§†è®­ç»ƒå¹³å°çš„æ˜¾å­˜å¤§å°ï¼Œå¯ä»¥è°ƒæ•´model.pyä¸­çš„self.max_hitsï¼Œè¿™å°†å†³å®šæ¯ä¸ªbatché€å…¥æ¨¡å‹çš„hitsæ•°é‡ã€‚

---

å¦‚éœ€è¿›ä¸€æ­¥æ”¹è¿›æˆ–è´¡çŒ®ä»£ç ï¼Œè¯·æäº¤ PR æˆ–è”ç³»ä½œè€…ã€‚
